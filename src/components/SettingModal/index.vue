<template>
  <div>
    <a-modal
      :visible="modalå¯è§"
      fullscreen
      title-align="start"
      modal-animation-name="zoom-br"
      modal-class="no_header_modal"
      body-class="p-0"
      :footer="false"
      title="è®¾ç½®"
      @open="æ‰“å¼€model()"
      @cancel="modalå–æ¶ˆ()"
      @close="modalå…³é—­åŠ¨ç”»ç»“æŸ()"
    >
      <header
        ref="è®¾ç½®å¼¹æ¡†Header"
        class="setting_header h-48px w-full sticky top-0 text-16px px-20px z-1 flex-y-c justify-between backdrop-blur-5px"
      >
        <div class="horizontal-place-8px">
          <img src="/favicon.svg" width="24" />
          <span class="font-500">è®¾ç½®</span>
        </div>
        <div>
          <button
            class="w-20px aspect-ratio-square flex-c rounded-full transition-all hover:bg-#777:10 dark:(hover:bg-#fff:10)"
            @click="modalå–æ¶ˆ()"
          >
            <i i-fe-close class="text-14px"></i>
          </button>
        </div>
      </header>
      <div class="header_shadow"></div>
      <section
        ref="modalä¸»ä½“Ref"
        class="w-full top-0 bottom-0 px-20px py-16px overflow-x-hidden"
      >
        <div class="w-full flex">
          <div class="custom_bezier" :class="[!ä¾§è¾¹æ”¶èµ· ? 'w-70%' : 'w-full']">
            <setting-card @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ()">
              <template #title>
                <div class="horizontal-place-4px">
                  <i i-fluent-emoji-flat-wind-chime class="text-19px" />
                  <span>ä¸€äº›æç¤º</span>
                </div>
              </template>
              <section :class="åŠ¨æ€å®½åº¦ç±»å">
                <ul class="mb-18px list-disc pl-16px">
                  <li>
                    æ’ä»¶çš„åŠŸèƒ½ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œä¸å¹¸çš„æ˜¯ï¼Œé™¤è°·æ­Œç¿»è¯‘å¤–ï¼Œå…¶ä»–çš„æ‚¨éœ€è¦è‡ªè¡Œç”³è¯·ä¹‹åæ‰èƒ½ä½¿ç”¨å®ƒä»¬
                    <i class="text-18px" i-twemoji-slightly-frowning-face></i>
                    ï¼Œä½†æ˜¯ä¸‡å¹¸ï¼Œä»–ä»¬éƒ½æ˜¯å…è´¹çš„
                    <i class="text-18px" i-twemoji-grinning-face></i>
                  </li>
                  <li>
                    <a-link
                      id="guide-link"
                      class="-indent-4px"
                      target="_blank"
                      href="https://www.wolai.com/jtSV7oah6M7rErz2RMFzo"
                      @click="æ‰“å¼€url('https://www.wolai.com/jtSV7oah6M7rErz2RMFzo')"
                    >
                      å¤§åŠ›ç‚¹å‡»è¿™é‡Œï¼Œäº†è§£å¦‚ä½•ç”³è¯·~
                    </a-link>
                  </li>
                  <li @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('å…³äºè‡ªåŠ¨å¤åˆ¶')">
                    å¦‚æœä½ ä½¿ç”¨uToolsçš„
                    <span class="text_important">å…¨å±€å¿«æ·é”®</span>
                    åŠŸèƒ½ï¼Œè¯·å°†å…³é”®å­—è¯·è®¾ç½®ä¸º â€œ<span
                      class="select-all text_important text-15px code_font-family"
                      >fjyi</span
                    >â€
                  </li>
                </ul>
              </section>
            </setting-card>
            <a-form auto-label-width :model="formData">
              <a-row>
                <section class="mt-18px space-y-18px flex-1">
                  <setting-card>
                    <template #title>
                      <div class="horizontal-place-6px">
                        <i i-fluent-emoji-flat-gear class="text-16px" />
                        <span>åŸºæœ¬è®¾ç½®</span>
                      </div>
                    </template>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="ç¿»è¯‘æœåŠ¡:" @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('ç¿»è¯‘æœåŠ¡')">
                        <a-checkbox-group v-model="formData.homeHasApi">
                          <a-checkbox
                            v-for="item in apiåˆ—è¡¨"
                            :key="item.value"
                            :value="item.value"
                            :disabled="
                              !formData.homeHasApi.includes(item.value) &&
                              formData.homeHasApi?.length >= å¯é€‰æ‹©çš„æœåŠ¡æ•°é‡
                            "
                          >
                            {{ item.label }}
                          </a-checkbox>
                        </a-checkbox-group>
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item
                        label="ä¸»é¡µæ˜¾ç¤ºé¡ºåº:"
                        @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('ä¸»é¡µæ˜¾ç¤ºé¡ºåº')"
                      >
                        <div class="horizontal-place-8px">
                          <template v-for="(item, index) in æ˜¾ç¤ºé¡ºåºdata" :key="item">
                            <i
                              v-if="index > 0"
                              i-ic-twotone-keyboard-double-arrow-right
                              class="mt-1px text-#777:70"
                            />
                            <span>{{ item.label }}</span>
                          </template>
                        </div>
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item
                        label="æ–‡æœ¬æ¡†å­—å·:"
                        @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('æ–‡æœ¬æ¡†å­—å·')"
                      >
                        <a-input-number
                          v-model="formData.textFont"
                          :min="14"
                          :max="20"
                          placeholder="è¯·è¾“å…¥æ–‡æœ¬æ¡†å­—å·ï¼ˆ14 ~ 20ï¼‰"
                          mode="button"
                        >
                          <template #suffix> åƒç´  </template>
                        </a-input-number>
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item
                        label="å¿«æ·é”®è¡Œä¸º:"
                        @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('å¿«æ·é”®è¡Œä¸º')"
                      >
                        <a-radio-group v-model="formData.copyBtnBehavior">
                          <a-radio value="open">ä»…å¤åˆ¶</a-radio>
                          <a-radio value="close"> å¤åˆ¶åéšè—æ’ä»¶ </a-radio>
                          <a-radio value="closeInput"> å¤åˆ¶éšè—å¹¶è¾“å…¥ </a-radio>
                        </a-radio-group>
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="æ˜¾ç¤ºæŒ‰é’®:" @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('æ˜¾ç¤ºæŒ‰é’®')">
                        <a-checkbox-group v-model="formData.copyBtnShow">
                          <a-checkbox :value="1">ä»…å¤åˆ¶</a-checkbox>
                          <a-checkbox :value="2">å¤åˆ¶å¹¶éšè—</a-checkbox>
                          <a-checkbox :value="3">å¤åˆ¶å¹¶è¾“å…¥</a-checkbox>
                        </a-checkbox-group>
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item
                        label="é»˜è®¤ç›®æ ‡å¤–è¯­:"
                        class="flex items-start"
                        @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('é»˜è®¤ç›®æ ‡å¤–è¯­')"
                      >
                        <a-radio-group v-model="formData.defaultForeignLanguage">
                          <a-radio value="en"> è‹±è¯­ </a-radio>
                          <a-radio value="jp"> æ—¥è¯­ </a-radio>
                          <a-radio value="ru"> ä¿„è¯­ </a-radio>
                        </a-radio-group>
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="æ’ä»¶ä¸»é¢˜:" @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('æ’ä»¶ä¸»é¢˜')">
                        <a-radio-group v-model="formData.theme">
                          <a-radio value="auto">è·ŸéšuTools</a-radio>
                          <a-radio value="light"> æµ…è‰² </a-radio>
                          <a-radio value="dark"> æ·±è‰² </a-radio>
                        </a-radio-group>
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="è¯­éŸ³æœ—è¯»:" @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('è¯­éŸ³æœ—è¯»')">
                        <a-switch v-model="formData.readAloud" class="ml-5px"> </a-switch>
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="æœ—è¯»åå¥½:" @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('æœ—è¯»åå¥½')">
                        <a-radio-group
                          v-model="formData.readingPreference"
                          :disabled="!formData.readAloud"
                        >
                          <a-radio value="default">ç³»ç»Ÿé»˜è®¤</a-radio>
                          <a-radio value="male"> ä»…ç”·å£° </a-radio>
                          <a-radio value="female"> ä»…å¥³å£° </a-radio>
                        </a-radio-group>
                      </a-form-item>
                    </section>
                  </setting-card>
                  <setting-card @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('ç¿»è¯‘æœåŠ¡æ•°æ®')">
                    <template #title>
                      <div class="horizontal-place-4px">
                        <i i-flat-color-icons-menu class="text-18px" />
                        <!-- i-flat-color-icons-list -->
                        <span>ç¿»è¯‘æœåŠ¡æ•°æ®</span>
                      </div>
                    </template>
                    <a-divider orientation="left">
                      <div class="divide_content">
                        <ApiIcon :data="{ value: 'baidu' }" />
                        <span>ç™¾åº¦ç¿»è¯‘</span>
                      </div>
                    </a-divider>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="APP ID:">
                        <a-input
                          v-model.trim="formData.appid"
                          placeholder="è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘çš„APP ID"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="å¯†é’¥:">
                        <a-input-password
                          v-model.trim="formData.token"
                          placeholder="è¯·è¾“å…¥ç™¾åº¦ç¿»è¯‘çš„å¯†é’¥"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                    <a-divider orientation="left">
                      <div class="divide_content">
                        <ApiIcon :data="{ value: 'tencent' }" />
                        <span>è…¾è®¯äº‘ç¿»è¯‘</span>
                      </div>
                    </a-divider>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="Secret Id:">
                        <a-input
                          v-model.trim="formData.secretId"
                          placeholder="è¯·è¾“å…¥è…¾è®¯ç¿»è¯‘Secret Id"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="Secret Key:">
                        <a-input-password
                          v-model.trim="formData.secretKey"
                          placeholder="è¯·è¾“å…¥è…¾è®¯ç¿»è¯‘Secret Key"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                    <a-divider orientation="left">
                      <div class="divide_content">
                        <ApiIcon :data="{ value: 'ali' }" />
                        <span>é˜¿é‡Œäº‘ç¿»è¯‘</span>
                      </div>
                    </a-divider>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="Secret Id:">
                        <a-input
                          v-model.trim="formData.accessKeyId"
                          placeholder="è¯·è¾“å…¥é˜¿é‡Œäº‘AccessKeyID"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="Secret Key:">
                        <a-input-password
                          v-model.trim="formData.accessKeySecret"
                          placeholder="è¯·è¾“å…¥é˜¿é‡Œäº‘Access Key Secret"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                    <a-divider orientation="left">
                      <div class="divide_content">
                        <ApiIcon :data="{ value: 'youdao' }" />
                        <span>æœ‰é“ç¿»è¯‘</span>
                      </div>
                    </a-divider>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="åº”ç”¨ID:">
                        <a-input
                          v-model.trim="formData.youdaoId"
                          placeholder="è¯·è¾“å…¥æœ‰é“æ™ºäº‘åº”ç”¨ID"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="åº”ç”¨å¯†é’¥:">
                        <a-input-password
                          v-model.trim="formData.youdaoSecret"
                          placeholder="è¯·è¾“å…¥æœ‰é“æ™ºäº‘åº”ç”¨å¯†é’¥"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                    <a-divider orientation="left">
                      <div class="divide_content">
                        <ApiIcon :data="{ value: 'caiyun' }" />
                        <span>å½©äº‘å°è¯‘</span>
                      </div>
                    </a-divider>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="ä»¤ç‰Œ:">
                        <a-input-password
                          v-model.trim="formData.caiyunToken"
                          placeholder="è¯·è¾“å…¥å½©äº‘å°è¯‘ä»¤ç‰Œ"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                    <a-divider orientation="left">
                      <div class="divide_content">
                        <ApiIcon :data="{ value: 'huoshan' }" />
                        <span>ç«å±±ç¿»è¯‘</span>
                      </div>
                    </a-divider>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="AccessKeyID:">
                        <a-input
                          v-model.trim="formData.huoshanAccessKeyId"
                          placeholder="è¯·è¾“å…¥ç«å±±ç¿»è¯‘AccessKeyID"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                    <section :class="åŠ¨æ€å®½åº¦ç±»å">
                      <a-form-item label="SecretAccessKey:">
                        <a-input-password
                          v-model.trim="formData.huoshanSecretAccessKey"
                          placeholder="è¯·è¾“å…¥ç«å±±ç¿»è¯‘SecretAccessKey"
                          allow-clear
                        />
                      </a-form-item>
                    </section>
                  </setting-card>
                </section>
              </a-row>
            </a-form>
            <setting-card class="mt-18px" @mouseenter="åˆ‡æ¢æ–‡æ¡ˆ('é…ç½®ä¿¡æ¯')">
              <template #title>
                <div class="horizontal-place-6px">
                  <i i-fxemoji-opticaldisc class="text-16px"></i>
                  <span>é…ç½®ä¿¡æ¯</span>
                </div>
              </template>
              <div class="space-x-16px mb-20px">
                <a-button
                  :type="è·å–å½“å‰('ä¸»é¢˜') === 'light' ? 'outline' : 'primary'"
                  @click="æ‰“å¼€å¯¼å…¥å¼¹çª—()"
                >
                  <template #icon>
                    <i class="text-20px mb-1px" i-line-md-download-loop />
                    <!-- i-lucide-download -->
                  </template>
                  å¯¼å…¥
                </a-button>

                <a-button
                  :type="è·å–å½“å‰('ä¸»é¢˜') === 'light' ? 'outline' : 'primary'"
                  @click="æ‰“å¼€å¯¼å‡ºå¼¹çª—()"
                >
                  <template #icon>
                    <i class="text-20px mb-1px" i-line-md-upload-loop />
                    <!-- i-lucide-upload -->
                  </template>
                  å¯¼å‡º
                </a-button>
              </div>
            </setting-card>
          </div>
          <div
            class="right relative transition-all ml-16px"
            :class="{ '-mr-100% opacity-30': ä¾§è¾¹æ”¶èµ· }"
          >
            <setting-card
              class="fixed pb-16px w-[calc(30%-24px)]"
              :style="{
                top: `${ä¾§è¾¹å®šä½top}px`,
                bottom: `${ä¾§è¾¹å®šä½bottom}px`,
              }"
            >
              <template #title>
                <div class="horizontal-place-6px">
                  <i i-noto-v1-bookmark class="text-18px mb-2px"></i>
                  <span>é€‰é¡¹è¯´æ˜</span>
                </div>
              </template>
              <button
                class="bg-white rounded-full shadow-md w-22px grid-c text-18px cursor-pointer absolute-y-center aspect-ratio-square -left-11px transition-all active:shadow dark:bg-#444"
                @click="åˆ‡æ¢ä¾§è¾¹()"
              >
                <i
                  i-ic-outline-keyboard-arrow-left
                  class="transition-all !duration-500"
                  :class="[ä¾§è¾¹æ”¶èµ· ? 'rotate-0' : '-rotate-180']"
                />
              </button>
              <div
                class="flex flex-col"
                v-html="è§£é‡Šæ–‡æ¡ˆ || 'é¼ æ ‡æ‚¬æµ®å·¦ä¾§é€‰é¡¹ä¸Šå¯æŸ¥çœ‹å¯¹åº”é€‰é¡¹è¯´æ˜'"
              ></div>
            </setting-card>
          </div>
        </div>
      </section>

      <section
        ref="è®¾ç½®å¼¹æ¡†Footer"
        class="sticky bottom-0 h-65px flex-y-c justify-between px-20px bg-white dark:bg-#2a2a2b"
        border="t-solid #e5e6eb t-width-1px dark:#484849"
      >
        <div>
          <a-popconfirm
            position="tl"
            content-class="popconfirm_wrapper"
            type="warning"
            content="ç¡®å®šè¦é‡ç½®æœ¬æ’ä»¶çš„æ•°æ®å—ï¼Ÿé‡ç½®å¯ä»¥è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ï¼Œä½†åœ¨æ­¤ä¹‹å‰è¯·å¤‡ä»½å¥½ç›¸å…³æœåŠ¡çš„ä¿¡æ¯å“¦~"
            ok-text="å–æ¶ˆ"
            cancel-text="ç¡®å®š"
            @cancel="é‡ç½®æ•°æ®()"
          >
            <a-button type="outline" status="danger">é‡ç½®æ’ä»¶æ•°æ®</a-button>
          </a-popconfirm>
        </div>
        <div class="space-x-12px">
          <a-button @click="modalå–æ¶ˆ()">å–æ¶ˆ</a-button>
          <a-button type="primary" @click="è®¾ç½®modalç¡®å®š()">ç¡®å®š</a-button>
        </div>
      </section>
    </a-modal>

    <!-- å¯¼å…¥å¼¹çª— -->
    <ImportModal ref="å¯¼å…¥å¼¹æ¡†Ref" @importSubmit="å¯¼å…¥æäº¤($event)" />

    <!-- å¯¼å‡ºå¼¹çª— -->
    <ExportModal ref="å¯¼å‡ºå¼¹æ¡†Ref" @exportSubmit="å¯¼å‡ºæäº¤($event)" />
  </div>
</template>

<script setup lang="ts">
import {
  useGlobalStore,
  è·å–å­˜å‚¨é¡¹,
  è®¾ç½®å­˜å‚¨,
} from '@/components/SettingModal/SettingsModules'
import {
  cloneDeep,
  æç¤º,
  æ˜¾ç¤ºå¼•å¯¼,
  æ›¿æ¢å­—ç¬¦ä¸²,
  æ¸…é™¤å¼•å¯¼,
  è·å–å½“å‰,
} from '@/components/SettingModal/SettingsUtils'
import { apié€‰é¡¹, æ–‡æ¡ˆæ˜ å°„ } from '@/components/SettingModal/SettingsData'
import type { å¼•å¯¼optionsç±»å‹ } from '@/components/SettingModal/SettingsTypes'
const emit = defineEmits(['ok', 'cancel', 'reset'])
const è®¾ç½®å¼¹æ¡†Header = ref()
const è®¾ç½®å¼¹æ¡†Footer = ref()
const { height: è®¾ç½®å¼¹æ¡†Headeré«˜åº¦ } = useElementSize(è®¾ç½®å¼¹æ¡†Header)
const { height: è®¾ç½®å¼¹æ¡†Footeré«˜åº¦ } = useElementSize(è®¾ç½®å¼¹æ¡†Footer)

const ä¾§è¾¹paddingY = 16
const ä¾§è¾¹å®šä½top = computed(() => {
  return è®¾ç½®å¼¹æ¡†Headeré«˜åº¦.value + ä¾§è¾¹paddingY
})

const ä¾§è¾¹å®šä½bottom = computed(() => {
  return è®¾ç½®å¼¹æ¡†Footeré«˜åº¦.value + ä¾§è¾¹paddingY + 1
})
const ç³»ç»Ÿ = è·å–å½“å‰('ç³»ç»Ÿ')
const apiåˆ—è¡¨ = ref(apié€‰é¡¹)
const modalå¯è§ = ref(false)
const modalä¸»ä½“Ref = ref()
const å¯¼å…¥å¼¹æ¡†Ref = ref()
const å¯¼å‡ºå¼¹æ¡†Ref = ref()
const è§£é‡Šæ–‡æ¡ˆ = ref('') // è§£é‡Šæ–‡æ¡ˆ
const formData = reactive({
  homeHasApi: ['baidu', 'tencent', 'youdao', 'ali'], // é¦–é¡µå±•ç¤ºçš„ç¿»è¯‘æ–¹å¼
  textFont: 16, // æ–‡æœ¬æ¡†å­—å·
  copyBtnBehavior: 'open', // å¿«æ·é”®çš„è¡Œä¸º
  copyBtnShow: [1, 2, 3], // é¦–é¡µæ˜¾ç¤ºçš„æŒ‰é’®
  readAloud: true, // è¯­éŸ³æœ—è¯»
  readingPreference: 'default', // æœ—è¯»åå¥½
  codeMode: false, // å‘½åç¿»è¯‘æ¨¡å¼
  defaultForeignLanguage: 'en', // é»˜è®¤ç›®æ ‡å¤–è¯­
  defaultApi: '', // é»˜è®¤ç¿»è¯‘æ–¹å¼
  theme: 'auto',
  appid: undefined, // ç™¾åº¦
  token: undefined, // ç™¾åº¦
  secretId: undefined, // è…¾è®¯
  secretKey: undefined, // è…¾è®¯
  accessKeyId: undefined, // é˜¿é‡Œ
  accessKeySecret: undefined, // é˜¿é‡Œ
  youdaoId: undefined, // æœ‰é“
  youdaoSecret: undefined, // æœ‰é“
  caiyunToken: undefined, // å½©äº‘
  huoshanAccessKeyId: undefined, // ç«å±±
  huoshanSecretAccessKey: undefined, // ç«å±±
})
const æ˜¾ç¤ºé¡ºåºdata = computed(() => {
  const æ‰€æœ‰æœåŠ¡ = cloneDeep(apiåˆ—è¡¨.value)
  const é€‰çš„æœåŠ¡ = cloneDeep(formData.homeHasApi)
  const arr = é€‰çš„æœåŠ¡.map((i, idx) => {
    return {
      ...æ‰€æœ‰æœåŠ¡.find(j => j.value === i),
      sort: idx,
    }
  })
  return arr
})

const utools = window?.utools

const { è·å–è®¾ç½®, ä¿å­˜è®¾ç½®, é‡ç½®è®¾ç½®, å¯¼å…¥é…ç½®, å¯¼å‡ºè®¾ç½® } = è®¾ç½®å­˜å‚¨(formData)
const é¦–é¡µçš„apiæ•°ç»„ = ref<string[]>([]) // å½“å‰é¦–é¡µå±•ç¤ºçš„ç¿»è¯‘æ–¹å¼

const å·²å‹¾é€‰çš„ç¿»è¯‘ = computed(() => {
  return apiåˆ—è¡¨.value.filter(i => é¦–é¡µçš„apiæ•°ç»„.value.includes(i.value))
})

const { copy: å¤åˆ¶ } = useClipboard() // å¤åˆ¶ç»“æœåŠŸèƒ½

// ç›‘å¬é¦–é¡µç¿»è¯‘æ–¹å¼çš„checkboxå‹¾é€‰æ•°é‡
const å¯é€‰æ‹©çš„æœåŠ¡æ•°é‡ = ref(4)
watchEffect(() => {
  const å·²é€‰æ‹©çš„apié•¿åº¦ = formData.homeHasApi?.length
  if (å·²é€‰æ‹©çš„apié•¿åº¦ > å¯é€‰æ‹©çš„æœåŠ¡æ•°é‡.value) {
    formData.homeHasApi = é¦–é¡µçš„apiæ•°ç»„.value
    æç¤º.warning({ content: 'æœ€å¤šåªèƒ½é€‰æ‹©4ä¸ªç¿»è¯‘æ–¹å¼å“¦~', duration: 2500 })
  } else if (å·²é€‰æ‹©çš„apié•¿åº¦ < 1) {
    formData.homeHasApi = é¦–é¡µçš„apiæ•°ç»„.value
    æç¤º.warning({
      content: 'è¿˜æ˜¯è‡³å°‘ç•™ä¸‹1ä¸ªç¿»è¯‘æ–¹å¼å§ï¼',
      duration: 2500,
    })
  }
  é¦–é¡µçš„apiæ•°ç»„.value = formData.homeHasApi
})

// ç›‘å¬é»˜è®¤ç¿»è¯‘æ–¹å¼çš„ä¸‹æ‹‰é€‰é¡¹
// å¦‚æœé€‰æ‹©äº†"é»˜è®¤ç¿»è¯‘æ–¹å¼"ä¸º"é¦–é¡µç¿»è¯‘æ–¹å¼"ä¸å­˜åœ¨çš„ï¼Œåˆ™æŠŠå¯ç”¨çš„ç¿»è¯‘æ–¹å¼ç¬¬ä¸€ä¸ªèµ‹å€¼ç»™é»˜è®¤
watchEffect(() => {
  if (!é¦–é¡µçš„apiæ•°ç»„.value.includes(formData.defaultApi)) {
    formData.defaultApi = å·²å‹¾é€‰çš„ç¿»è¯‘.value[0].value
  }
})

const å…¨å±€å­˜å‚¨ = useGlobalStore()
const ä¾§è¾¹æ”¶èµ· = computed(() => å…¨å±€å­˜å‚¨.ä¾§è¾¹æ”¶èµ·)
const åŠ¨æ€å®½åº¦ç±»å = computed(() => {
  return ä¾§è¾¹æ”¶èµ·.value ? 'w-80%' : 'w-full'
})

function åˆ‡æ¢ä¾§è¾¹() {
  if (!ä¾§è¾¹æ”¶èµ·.value) {
    åˆ‡æ¢æ–‡æ¡ˆ()
  }
  å…¨å±€å­˜å‚¨.è®¾ç½®ä¾§è¾¹æ”¶èµ·()
}
function è®¾ç½®modalç¡®å®š() {
  ä¿å­˜è®¾ç½®()
  æç¤º.success({ content: 'è®¾ç½®æˆåŠŸ', duration: 1000 })
  emit('ok')
  å…³é—­å¼¹çª—()
}

// ç‚¹å‡»å¼¹æ¡†å–æ¶ˆ
function modalå–æ¶ˆ() {
  æ¸…é™¤å¼•å¯¼()
  emit('cancel')
  å…³é—­å¼¹çª—()
}
// æ‰“å¼€è®¾ç½®å¼¹æ¡†ï¼ˆåŠ¨ç”»ç»“æŸï¼‰å›è°ƒ
function æ‰“å¼€model() {
  !è·å–å­˜å‚¨é¡¹('firstUseSetting') && é¦–æ¬¡å¼•å¯¼()
}

// é¦–æ¬¡æç¤ºé“¾æ¥ä½ç½®
function é¦–æ¬¡å¼•å¯¼() {
  const option: å¼•å¯¼optionsç±»å‹ = {
    id: 'firstUseSetting',
    title: 'è¿™é‡Œæœ‰ä¸€äº›æç¤º',
    text: 'è¿™å¯æ˜¯æˆ‘èµ·æ—©è´ªé»‘å†™çš„ï¼Œä½ å¯ä»¥åœ¨ç‚¹å‡»â€å…³é—­â€œæŒ‰é’®åç‚¹å‡»é“¾æ¥æŸ¥çœ‹ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ ç”³è¯·åˆ°è¿™äº›å…è´¹çš„æœåŠ¡ï¼Œå¦‚æœä½ å·²ç»æ˜¯ä¸ªè€æ‰‹äº†ï¼Œé‚£å°±å…³é—­è¿™ä¸ªå¯¹è¯æ¡†å¼€å§‹ä½¿ç”¨å§~',
    attachTo: {
      element: '#guide-link',
      on: 'right',
    },
    classes: 'guide_wrapper',
  }
  æ˜¾ç¤ºå¼•å¯¼(option, 'firstUseSetting')
}

function æ‰“å¼€å¼¹çª—() {
  modalå¯è§.value = true
  è·å–è®¾ç½®()
}

function å…³é—­å¼¹çª—() {
  modalå¯è§.value = false
}

function modalå…³é—­åŠ¨ç”»ç»“æŸ() {
  åˆ‡æ¢æ–‡æ¡ˆ()
}

function æ‰“å¼€url(url: string) {
  if (!utools) {
    return
  }
  utools.shellOpenExternal(url)
}

function é‡ç½®æ•°æ®() {
  é‡ç½®è®¾ç½®()
  æç¤º.success({ content: 'å·²é‡ç½®', duration: 1000 })
  // å…³é—­å¼¹çª—å¹¶é€šçŸ¥é‡ç½®
  setTimeout(() => {
    å…³é—­å¼¹çª—()
    emit('reset')
  }, 300)
}

const å¿«æ·é”®æ–‡æ¡ˆ = computed(() => {
  const m = new Map([
    ['macOS', 'Command+Shift+C'],
    ['Windows', 'Ctrl+Shift+C'],
    ['Linux', 'Ctrl+Shift+C'],
  ])
  return m.get(ç³»ç»Ÿ) || 'Ctrl+Shift+C / Command+Shift+C'
})

function åˆ‡æ¢æ–‡æ¡ˆ(id = '') {
  if (ä¾§è¾¹æ”¶èµ·.value) {
    return
  }
  if (!id) {
    è§£é‡Šæ–‡æ¡ˆ.value = ''
    return
  }

  let æ–‡æ¡ˆä¸»ä½“ = æ–‡æ¡ˆæ˜ å°„?.[id]
  // å¿«æ·é”®çš„æ–‡æ¡ˆä¸­åŒ…å«åŠ¨æ€æ–‡å­—ï¼Œéœ€è¦æ›¿æ¢
  if (id === 'å¿«æ·é”®è¡Œä¸º') {
    æ–‡æ¡ˆä¸»ä½“ = æ›¿æ¢å­—ç¬¦ä¸²(æ–‡æ¡ˆä¸»ä½“, ['%s', å¿«æ·é”®æ–‡æ¡ˆ.value])
  }
  è§£é‡Šæ–‡æ¡ˆ.value = `<h2 class="text-20px">${id}:</h2>${æ–‡æ¡ˆä¸»ä½“}`
}

function æ‰“å¼€å¯¼å…¥å¼¹çª—() {
  å¯¼å…¥å¼¹æ¡†Ref.value.æ‰“å¼€å¯¼å…¥å¼¹çª—()
}

interface importType {
  text: string
  password: string
}

async function å¯¼å…¥æäº¤(data: importType) {
  try {
    await å¯¼å…¥é…ç½®(data.text, data.password)
    ä¿å­˜è®¾ç½®()
    æç¤º.success('å¯¼å…¥æˆåŠŸï¼Œæ¬¢è¿å›æ¥~ğŸ‰')
    å¯¼å…¥å¼¹æ¡†Ref.value.å…³é—­å¯¼å…¥å¼¹çª—()
    emit('ok')
    å…³é—­å¼¹çª—()
  } catch (e) {
    æç¤º.error('å¯¼å…¥å‡ºé”™äº†ï¼Œå¯èƒ½æ˜¯é…ç½®ä¿¡æ¯æœ‰è¯¯æˆ–å¯†ç é”™è¯¯ğŸ˜¯')
  }
}

function æ‰“å¼€å¯¼å‡ºå¼¹çª—() {
  å¯¼å‡ºå¼¹æ¡†Ref.value.æ‰“å¼€å¯¼å‡ºå¼¹çª—()
}

async function å¯¼å‡ºæäº¤(password: string) {
  try {
    const å¯¼å‡ºå†…å®¹: string = await å¯¼å‡ºè®¾ç½®(password)
    await å¤åˆ¶(å¯¼å‡ºå†…å®¹)
    æç¤º.success('å¯¼å‡ºæˆåŠŸï¼Œå·²å°†é…ç½®ä¿¡æ¯å†™å…¥åˆ°å‰ªåˆ‡æ¿~')
    å¯¼å‡ºå¼¹æ¡†Ref.value.å…³é—­å¯¼å‡ºå¼¹çª—()
  } catch (error) {
    æç¤º.error('å¯¼å‡ºå‡ºé”™äº†ï¼Œç¨åå†è¯•ä¸€ä¸‹å§ğŸ˜¯')
  }
}

// æš´éœ²å¼¹çª—çš„å‡½æ•°ï¼Œä¾›çˆ¶ç»„ä»¶è°ƒç”¨
defineExpose({
  æ‰“å¼€å¼¹çª—,
  å…³é—­å¼¹çª—,
  modalå¯è§,
})
</script>

<style lang="scss" scoped>
.divide_content {
  @apply flex-c space-x-4px;
}

.custom_bezier {
  transition: all 0.4s var(--ani-bezier);
}
.setting_header {
  background: radial-gradient(transparent, white 2px);
  // è¿™é‡Œçš„importantä¸å¯ä»¥å»é™¤ï¼Œå› ä¸ºbackgroundåœ¨æ·±è‰²æ¨¡å¼éœ€è¦è¦†ç›–ï¼Œä½†æ˜¯backgroundåˆåŒ…å«-size
  // å¦‚æœä¸åŠ è¿™ä¸ªimportantï¼Œé‚£ä¹ˆæ­¤å¤„çš„background-sizeå°†è¢«æ·±è‰²çš„backgroundè¦†ç›–
  background-size: 5px 5px !important;
}
.header_shadow {
  &::before {
    content: '';
    box-shadow: 0 1px 8px 1px #172a4770;
    @apply fixed w-full;
  }
  &::after {
    content: '';
    @apply w-full h-20px absolute;
    background: linear-gradient(to bottom, white 50%, transparent);
  }
}
</style>
